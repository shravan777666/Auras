# Dynamic Add-on Feature with Revenue-Sharing Commission Model

## Overview

This feature automatically detects idle time slots in staff schedules, predicts which customers are most likely to accept add-on services using a Decision Tree ML model, suggests discounted services, and splits revenue between the salon and admin platform.

## Key Components

### 1. Database Models

#### SalonSettings
- Stores configurable parameters for each salon
- Fields: adminCommissionRate, dynamicAddonDiscount, minGapForOffer, maxGapForOffer

#### AddonSales
- Records all add-on transactions
- Tracks revenue distribution between admin and salon

### 2. Machine Learning Model

#### Decision Tree Classifier
- Predicts customer acceptance of add-on offers
- Features: time_gap_size, discount_offered, customer_loyalty, past_add_on_history, day_of_week
- Target: conversion_outcome (1 = accepted, 0 = rejected)

### 3. Gap Detection

- Identifies idle time slots between appointments
- Configurable minimum and maximum gap sizes
- Returns available slots for add-on offers

### 4. Commission Logic

- Calculates admin commission: discounted_price * admin_commission_rate
- Calculates salon earnings: discounted_price - admin_commission
- Records all transactions in AddonSales collection

## API Endpoints

### Salon Settings
- `GET /api/salon-settings/me` - Get current salon's settings
- `PUT /api/salon-settings/me` - Update current salon's settings
- `GET /api/salon-settings/:salonId` - Get specific salon's settings (admin)
- `PUT /api/salon-settings/:salonId` - Update specific salon's settings (admin)

### Add-on Functionality
- `GET /api/addon/idle-slots` - Detect idle time slots
- `GET /api/addon/customer-history` - Get customer history for predictions
- `POST /api/addon/predict` - Predict add-on acceptance
- `POST /api/addon/calculate-commission` - Calculate commission and record sale

### Dashboard
- `GET /api/addon-dashboard/salon` - Get salon dashboard data
- `GET /api/addon-dashboard/admin` - Get admin dashboard data
- `GET /api/addon-dashboard/staff-performance` - Get staff performance data

## Implementation Details

### Gap Detection Algorithm
1. Fetch all appointments for a salon on a specific date
2. Group appointments by staff member
3. Sort appointments by time
4. Calculate gaps between consecutive appointments
5. Filter gaps within configured min/max range

### ML Prediction Process
1. Gather customer history (loyalty, past add-ons)
2. Collect contextual data (gap size, day of week)
3. Apply salon-specific discount rate
4. Send data to Decision Tree model
5. Return prediction and probability

### Revenue Distribution
1. Calculate discounted service price
2. Apply admin commission rate
3. Determine salon earnings
4. Record transaction in database
5. Update financial dashboards

## Configuration

### Default Settings
- Admin Commission Rate: 15%
- Dynamic Add-on Discount: 20%
- Minimum Gap for Offer: 30 minutes
- Maximum Gap for Offer: 120 minutes

### Customization
Salons can adjust all parameters through the settings API endpoints.

## Dashboard Features

### Salon Dashboard
- Total add-on sales
- Revenue breakdown (total, admin commission, salon earnings)
- Top services
- Recent sales

### Admin Dashboard
- Platform-wide add-on metrics
- Top performing salons
- Popular services
- Revenue analytics

### Staff Performance
- Individual staff member performance
- Add-on sales per staff member
- Revenue generated by staff

## Integration Points

### Frontend Integration
- Real-time offer suggestions during booking
- Dashboard displays for salon owners and admins
- Settings management interface

### Backend Integration
- Appointment scheduling system
- Customer profile management
- Financial reporting system

## Future Enhancements

1. Advanced ML models (Random Forest, Neural Networks)
2. Real-time offer notifications
3. A/B testing for different discount strategies
4. Seasonal and trend-based adjustments
5. Integration with marketing automation